<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AstroScope 🚀</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icon-192.png" />
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 1rem;
      background: linear-gradient(to right, #1e3c72, #2a5298);
      color: white;
      text-align: center;
    }
    h1 { font-size: 2.5rem; margin-bottom: 1rem; }
    section {
      margin: 2rem auto;
      padding: 1.5rem;
      background: #ffffff11;
      border-radius: 1rem;
      max-width: 800px;
    }
    img {
      width: 100%;
      max-width: 600px;
      border-radius: 1rem;
      margin-top: 1rem;
    }
    input, select, button {
      padding: 0.8rem;
      margin: 0.5rem;
      font-size: 1rem;
      border-radius: 0.7rem;
      border: none;
    }
    button {
      background: #5a67d8;
      color: white;
      cursor: pointer;
    }
    #mars-gallery {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1rem;
      margin-top: 1rem;
    }
    #mars-gallery img, #gallery-results img {
      width: 100%;
      max-width: 300px;
      border-radius: 1rem;
    }
  </style>
</head>
<body>
  <h1>🔭 AstroScope</h1>

  <!-- APOD Section -->
  <section id="apod">
    <h2>🌌 Astronomy Picture of the Day</h2>
    <input type="date" id="apod-date" />
    <button onclick="getAPOD()">Get Picture</button>
    <div id="apod-result">
      <h3 id="apod-title"></h3>
      <img id="apod-img" src="" alt="" style="display:none;">
      <p id="apod-desc"></p>
    </div>
  </section>

  <!-- Mars Rover Photos -->
  <section id="mars-rover">
    <h2>🚗 Mars Rover Photos</h2>
    <label for="rover">Rover:</label>
    <select id="rover">
      <option value="curiosity">Curiosity</option>
      <option value="opportunity">Opportunity</option>
      <option value="spirit">Spirit</option>
    </select>
    <label for="mars-date">Date:</label>
    <input type="date" id="mars-date" max="2023-12-31" />
    <button onclick="getMarsPhotos()">📷 Show Photos</button>
    <div id="mars-gallery"></div>
  </section>

  <!-- Asteroids Section -->
  <section id="asteroids">
    <h2>☄️ Asteroid Close Approaches</h2>
    <input type="date" id="asteroid-date" max="2025-12-31">
    <button onclick="getAsteroids()">🛰️ Get Approaches</button>
    <div id="asteroid-list"></div>
  </section>

  <!-- People in Space -->
  <section id="people">
    <h2>👩‍🚀 People in Space</h2>
    <button onclick="fetchPeople()">🔄 Refresh</button>
    <div id="peopleList" style="margin-top: 1rem;"></div>
  </section>

  <!-- NASA Image & Video Gallery -->
  <section id="nasa-gallery">
    <h2>🖼️ NASA Image & Video Search</h2>
    <input type="text" id="gallery-query" placeholder="e.g. Saturn, Nebula, Mars" />
    <button onclick="searchGallery()">🔍 Search</button>
    <div id="gallery-results"></div>
  </section>

  <script>
    const API_KEY = "GoahzBndb1f0dDBn6OoWFi8qphcYSbKfD4kN7B6N";

    async function getAPOD() {
      const date = document.getElementById("apod-date").value;
      const url = `https://api.nasa.gov/planetary/apod?api_key=${API_KEY}&date=${date}`;
      try {
        const res = await fetch(url);
        const data = await res.json();
        document.getElementById("apod-title").textContent = data.title;
        const img = document.getElementById("apod-img");
        if (data.media_type === "image") {
          img.src = data.url;
          img.style.display = "block";
        } else {
          img.style.display = "none";
        }
        document.getElementById("apod-desc").textContent = data.explanation;
      } catch {
        document.getElementById("apod-title").textContent = "Error loading APOD.";
        document.getElementById("apod-desc").textContent = "";
        document.getElementById("apod-img").style.display = "none";
      }
    }

    async function getMarsPhotos() {
      const rover = document.getElementById("rover").value;
      const date = document.getElementById("mars-date").value;
      const gallery = document.getElementById("mars-gallery");
      gallery.innerHTML = "Loading...";
      const url = `https://api.nasa.gov/mars-photos/api/v1/rovers/${rover}/photos?earth_date=${date}&api_key=${API_KEY}`;
      try {
        const res = await fetch(url);
        const data = await res.json();
        if (data.photos.length === 0) {
          gallery.innerHTML = "No photos found.";
          return;
        }
        gallery.innerHTML = "";
        data.photos.slice(0, 10).forEach(photo => {
          const img = document.createElement("img");
          img.src = photo.img_src;
          gallery.appendChild(img);
        });
      } catch {
        gallery.innerHTML = "Error fetching photos.";
      }
    }

    async function getAsteroids() {
      const date = document.getElementById("asteroid-date").value;
      const list = document.getElementById("asteroid-list");
      list.innerHTML = "Fetching...";
      const url = `https://api.nasa.gov/neo/rest/v1/feed?start_date=${date}&end_date=${date}&api_key=${API_KEY}`;
      try {
        const res = await fetch(url);
        const data = await res.json();
        const neos = data.near_earth_objects[date];
        if (!neos || neos.length === 0) {
          list.innerHTML = "No asteroids found.";
          return;
        }
        list.innerHTML = "";
        neos.slice(0, 10).forEach(neo => {
          const div = document.createElement("div");
          div.style.margin = "1rem";
          div.style.background = "#ffffff22";
          div.style.borderRadius = "1rem";
          div.style.padding = "1rem";
          div.innerHTML = `
            <strong>${neo.name}</strong><br>
            Diameter: ${neo.estimated_diameter.meters.estimated_diameter_max.toFixed(1)} m<br>
            Speed: ${parseFloat(neo.close_approach_data[0].relative_velocity.kilometers_per_hour).toFixed(2)} km/h<br>
            Miss Distance: ${parseFloat(neo.close_approach_data[0].miss_distance.kilometers).toLocaleString()} km<br>
            Hazardous: ${neo.is_potentially_hazardous_asteroid ? "Yes 😱" : "No 😌"}
          `;
          list.appendChild(div);
        });
      } catch {
        list.innerHTML = "Error loading asteroid data.";
      }
    }

    async function fetchPeople() {
      const list = document.getElementById("peopleList");
      list.innerHTML = "Loading people...";
      try {
        const res = await fetch("https://api.open-notify.org/astros.json");
        const data = await res.json();
        list.innerHTML = `${data.number} people are in space:<br><br>`;
        data.people.forEach(person => {
          const div = document.createElement("div");
          div.textContent = `👨‍🚀 ${person.name} (${person.craft})`;
          list.appendChild(div);
        });
      } catch {
        list.innerHTML = "Error fetching people data.";
      }
    }

    async function searchGallery() {
      const query = document.getElementById("gallery-query").value;
      const gallery = document.getElementById("gallery-results");
      if (!query) return;
      gallery.innerHTML = "Searching...";
      try {
        const res = await fetch(`https://images-api.nasa.gov/search?q=${encodeURIComponent(query)}&media_type=image`);
        const data = await res.json();
        const items = data.collection.items.slice(0, 10);
        if (items.length === 0) {
          gallery.innerHTML = "No results found.";
          return;
        }
        gallery.innerHTML = "";
        items.forEach(item => {
          const img = document.createElement("img");
          img.src = item.links[0].href;
          gallery.appendChild(img);
        });
      } catch {
        gallery.innerHTML = "Error searching NASA images.";
      }
    }

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js');
    }
  </script>
</body>
</html>
